Option Explicit

' read 3W and 8P schedules and create diddies for each room that is occupied
Public Sub createDiddies()
    ' declare variables
    Dim initialsDict As Object
    Dim initialsCell As Range
    Dim room As Range
    Dim initials As Variant
    Dim nameAndProf As Variant
    Dim i As Integer
    Dim j As Integer
    Dim roomCell As Range
    Dim initialsString As String
    Dim newString As String
    
    
    
    
    Set initialsDict = CreateObject("Scripting.Dictionary")
    
    ' loop through all therapists to get initials, name and profession; add to dictionary
    For Each initialsCell In Sheets("All Therapists").Range("AllTherapistsInitials")
        If Not IsEmpty(initialsCell) And initialsCell.Value <> "-" And Not IsEmpty(initialsCell.Offset(0, 4)) Then
            initials = initialsCell.Value
            nameAndProf = initialsCell.Offset(0, 3) & " " & initialsCell.Offset(0, 2)
            initialsDict.Add Key:=initials, Item:=nameAndProf
        End If
    Next initialsCell
    
    ' initialize first room cell for diddies; offset for next is (28,0)
    Set roomCell = Sheets("NewDiddies").Range("$B$4")
    ' loop though rooms on 3W schedule; if y AND z columns are empty for a room, do not add
          
    
    ' room to diddie; otherwise loop through time slots and add therapists to diddie
    For Each room In Sheets("3W Schedule").Range("Rooms3WSchedule")
        ' if room is not empty, add it to diddies and get therapists
        If Not room.Offset(0, 23) = " " And Not room.Offset(0, 24) = " " And Not room.Offset(0, 23) = "" And Not room.Offset(0, 24) = "" Then
          
          ' add room number to first diddie
          roomCell.Value = room.Value
          ' i will start two rows below roomCell in the 6:30 time slot
          i = 2
          
          For j = 1 To 22
            If Not IsEmpty(room.Offset(0, j)) And Not room.Offset(0, j) = " " Then
                initialsString = room.Offset(0, j).Value
                newString = getInitials(initialsString)
                If initialsDict.Exists(newString) Then
                    roomCell.Offset(i, 0).Value = initialsDict(newString)
                End If
                
                ' get value from each time slot and put into diddie
                'roomCell.Offset(i, 0).Value = room.Offset(0, j).Value
            End If
            ' increment row on diddie schedule
            i = i + 1
          Next j
         
          ' increment to next diddie room number
          Set roomCell = roomCell.Offset(28, 0)
        End If
        
    Next room
    
End Sub

' clear all data in diddies
Public Sub clearDiddies()
Dim clearArea As Range
Dim cell As Range


For Each cell In Sheets("NewDiddies").Range("AllDiddiesSchedRange")
    cell.MergeArea.ClearContents
    
Next cell
 Sheets("NewDiddies").Range("AllDiddiesRooms").ClearContents
End Sub

' get string value from cell and extract and return initials
Public Function getInitials(initials As String) As String
    Dim newInitials As String
    
    If Len(initials) > 3 Then
        If Len(initials) > 5 Then
            newInitials = Right(initials, 3)
            newInitials = Replace(newInitials, " ", "")
            getInitials = newInitials
        Else
            getInitials = Right(initials, 2)
        End If

    Else
        getInitials = initials
    End If
End Function
